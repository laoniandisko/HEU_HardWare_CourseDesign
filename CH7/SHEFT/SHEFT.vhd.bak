Library IEEE;
USE IEEE.STD_LOGIC_1164.ALL;
ENTITY SHEFT IS
PORT (CLK,M,C0 : IN STD_LOGIC;
S   : IN STD_LOGIC_VECTOR(1 DOWNTO 0);
D   : IN STD_LOGIC_VECTOR(7 DOWNTO 0);
QB  :OUT STD_LOGIC_VECTOR(7 DOWNTO 0);
CN  :OUT STD_LOGIC);
END ENTITY;
ARCHITECTURE BEHAV OF SHEFT IS
SIGNAL ABC: STD_LOGIC_VECTOR(2 DOWNTO 0);
BEGIN 	
ABC <= S & M;
PROCESS (CLK,S)
VARIABLE REG8 : STD_LOGIC_VECTOR(8 DOWNTO 0);
VARIABLE CY : STD_LOGIC;
BEGIN
IF CLK'EVENT AND CLK = '1' THEN
    IF ABC="000" OR ABC= "001" THEN 
    REG8 := REG8;
  	END IF;
	IF ABC="010"  THEN 
		CY:=REG8(8); 
		REG8(8 DOWNTO 1) := REG8(7 DOWNTO 0);
		REG8(0):=CY;
	END IF;
	IF ABC="011"  THEN 
		CY:=REG8(8); 
		REG8(8 DOWNTO 1) := REG8(7 DOWNTO 0);
		REG8(0):=C0;
	END IF;
	IF ABC="100"  THEN
	    CY:=REG8(0); 
		REG8(7 DOWNTO 0) := REG8(8 DOWNTO 1);
		REG8(8):=CY;
	END IF;
	IF ABC="101"  THEN 
		CY:=REG8(0);
		REG8(7 DOWNTO 0) := REG8(8 DOWNTO 1);
		REG8(8):=C0;
	END IF;
	IF ABC="110" OR ABC="111" THEN 
		REG8(7 DOWNTO 0) := D(7 DOWNTO 0);
	END IF;
	QB(7 DOWNTO 1)<=REG8(7 DOWNTO 1);
END IF;
	QB(7 DOWNTO 0) <= REG8(7 DOWNTO 0);
	CN <=REG8(8);
	END PROCESS;
END BEHAV;
